#!/bin/bash

#Some config
DEF_LAN_DEV="enp0s31f6"
DEF_WLAN_DEV="wlp4s0"
WIFI_CONF_DIR="$HOME/pro/wifi"
VPN_CONF_DIR="$HOME/PDOne/vpn"
NAMESPACE="Default"
TEMPDIR="$HOME/.cm/tmp"
RECDIR="$HOME/.cm/rec"

mkdir -p $TEMPDIR
mkdir -p $RECDIR
#So we won't expose the extra files on the PATH

DIALOGRC=$(dirname $0)/dialog.conf
function src()
{
    source $(dirname $0)/inc/$1
}

src "functions.sh"
src "ifsmenu.sh"
src "connectmenu.sh"
src "mainmenu.sh"
src "wifimenu.sh"
src "ssidmenu.sh"
src "nsmenu.sh"
src "vlanmenu.sh"
src "vpnmenu.sh"
src "ipmenu.sh"
src "vethmenu.sh"
src "recmenu.sh"

function setup()
{
    #TODO check for tmux
    export TERM=tmux
    if [ -z $TMUX ] ; then
        echo "You need to run the Connection Manager inside TMux, lemme start it for you"
        tmux new-session -n "CM" "$0 $*"
        exit $?
    fi
}

function main()
{
    setup
    while [ 1 ] ; do
        mainmenu
        if [ $? -ne 0 ] ; then
            break
        fi
    done
    #case $DRET in
    #    1) echo "Connect to the Internet woo hoo"
    #       read
    #        ;;
    #esac
}

main

echo "Dead jim... dead."
read
#cleanup
tmux kill-session
